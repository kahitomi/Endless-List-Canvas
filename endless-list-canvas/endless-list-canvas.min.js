var EndlessList=function(){};EndlessList=function(h){var e=h.canvas,d=e.getContext("2d"),f=h.offset,o={x:0,y:0},j={x:0,y:0},m=0,q=0,c=new Date(),r,p=[],i={x:0,y:0},n=false,a=false,b=false,l=false,k=false,g=h.DPI||1;media={fps:60,animate:function(s){window.setTimeout(s,1000/media.fps)}},ease=function(v,s,u,t){return v+(s-v)*(1-Math.pow(2,-(t/u)*10))},heightList=[],moveToTime=1500,glidToTime=2000,touchstart=h.touchstart||function(){},touchmove=h.touchmove||function(){},touchend=h.touchend||function(){},touchleft=h.touchleft||function(){},touchright=h.touchright||function(){},swipeleft=h.swipeleft||function(){},swiperight=h.swiperight||function(){},pulldown=h.pulldown||function(){},pullend=h.pullend||function(){},tap=h.tap||function(){},shouldPullDown=false,check_direction=function(y,t){var w="",v=Number(t.x-y.x),u=Number(t.y-y.y),s=Math.abs(v),x=Math.abs(u);if(s<x*1.8){if(u<=0){w="up"}else{w="down"}}else{if(v>=0){w="right";lr=true}else{w="left";lr=true}}return w},pull=function(){},pullup=function(){pullend();pullup=function(){}},moveTo=function(A){a=true;var u=new Date().getTime(),v=1000/media.fps,s=m,z=A,x=moveToTime,y=0,t=media.animate,w=function(){if(!a){return false}c=new Date().getTime()-u;if((x-c)<v||b){m=ease(s,z,x,x);q=mainDraw(m);a=false;return false}m=ease(s,z,x,c);q=mainDraw(m);t(w)};t(w)},glidTo=function(A){a=true;var u=new Date().getTime(),v=1000/media.fps,s=m,z=A,x=glidToTime,y=0,t=media.animate,w=function(){if(!a){return false}c=new Date().getTime()-u;if((x-c)<v||b){m=ease(s,z,x,x);if(m>0){m=0}else{if(q+m-f.height<0){m=f.height-q}}q=mainDraw(m);a=false;return false}m=ease(s,z,x,c);if(m>0){m=0;q=mainDraw(m);a=false;return false}else{if(q+m-f.height<0){if(f.height<=q){m=f.height-q}else{m=0}q=mainDraw(m);a=false;return false}}if(q+m<2*f.height){pullup()}q=mainDraw(m);t(w)};t(w)},mainDraw=function(w){var v=h.main||function(){},u=0,t=0,s=0,x=false;d.clearRect(0,0,f.width,f.height);while(true){x=false;if(heightList[u]==undefined){t=v(w+s,u);heightList[u]=t;x=true}if(t==undefined){break}s+=heightList[u];if(s>-w&&s-heightList[u]<-w+f.height&&x==false){t=v(w+s-heightList[u],u);if(t!=heightList[u]){s=s-heightList[u]+t;heightList[u]=t}x=true}u++}return s},control={refresh:function(){mainDraw(m)},go:function(){n=false},stop:function(){n=true},goAnimate:function(){b=false},stopAnimate:function(){a=false;b=true},moveTo:function(s){moveTo(s)},zero:function(s){m=s;mainDraw(m)},gliding:function(){return a}},ePageXY=function(t){var s={x:0,y:0};if(t.touches==undefined){s.x=t.pageX;s.y=t.pageY}else{s.x=t.touches[0].pageX;s.y=t.touches[0].pageY}return s},startAction=function(t){var s=ePageXY(t);j.x=(s.x-f.left)*g;j.y=(s.y-f.top)*g;o.x=(s.x-f.left)*g;o.y=(s.y-f.top)*g;if(n){return false}c=new Date();shouldPullDown=false;pull=function(){shouldPullDown=true;pull=function(){}};pullup=function(){pullend();pullup=function(){}};a=false;tapping=true;k=true;r="";p=[];touchstart(o);t.preventDefault()},moveAction=function(u){if(n){return false}var t=ePageXY(u),s=function(){var x=(o.y-j.y),w=m+x,v=q+w-f.height;if(w>0){w=w/1.7;pull();l=true}else{if(v<0&&f.height<=q){w=f.height-q+v/1.7;l=true}}if(w!=NaN){q=mainDraw(w)}if(v<f.height){pullup()}};c=new Date();o.x=(t.x-f.left)*g||o.x;o.y=(t.y-f.top)*g||o.y;if(Math.abs(Math.sqrt(j.x*j.x+j.y*j.y)-Math.sqrt(o.x*o.x+o.y*o.y))>5){tapping=false}if(k&&!tapping){k=false;r=check_direction(j,o)}else{if(r=="left"){touchleft(o)}else{if(r=="right"){touchright(o)}else{if(r=="up"){s()}else{if(r=="down"){s()}}}}}p.push({time:c.getTime(),point:JSON.parse(JSON.stringify(o))});if(p.length>5){p.shift()}touchmove(o);u.preventDefault()},endAction=function(w){if(n){return false}if(tapping){o.x-=10;o.y-=5;tap(o)}else{var z=0,y=0,t=p.length,C,D;for(var A in p){if(A!=0){D=p[A];C=p[A-1];z+=D.point.x-C.point.x;y+=D.point.y-C.point.y}}i.x=z/(t-2);i.y=y/(t-2);if(r=="up"||r=="down"){if(l){var s=(o.y-j.y),v=m+s,u=q+v-f.height;if(v>0){v=v/1.7}else{if(u<0){v=f.height-q+u/1.7}}l=false;m=v}else{m+=o.y-j.y}}var B=m,u=q+m-f.height;if(B>0){moveTo(0)}else{if(u<0&&f.height<=q){moveTo(f.height-q)}else{if(u<0&&f.height>q){moveTo(0)}else{if(i.y){if(r=="up"||r=="down"){if(i.y>90){i.y=90}else{if(i.y<-90){i.y=-90}}glidTo(m+i.y*Math.abs(i.y))}}}}}if(shouldPullDown&&m>60*g){pulldown()}if(r=="left"){swipeleft(j,o)}else{if(r=="right"){swiperight(j,o)}}}tapping=false;k=false;r="";touchend(o);w.preventDefault()};q=mainDraw(m);e.addEventListener("touchstart",function(s){startAction(s)});e.addEventListener("touchmove",function(s){moveAction(s)});e.addEventListener("touchend",function(s){endAction(s)});return control};